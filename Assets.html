<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Website</title>
    <link rel="stylesheet" href="StylesAssets.css">
    <script src="ObjectLoop.js"></script>
    <script src="objectList.js"></script>
</head>
<body onload="assetMap.forEach(addAssetValueToDrop)">
    <div id="left-sidebar">
        <ul>
            <li>
                <a id="assets-link">
                    <div class="icon-container" style="background-color: #ffbf00;">
                        <div class="cube-rectangles">
                            <div class="cube"></div>
                            <div class="cube"></div>
                            <div class="cube"></div>
                        </div>
                        <p class="icon-title">Assets</p>
                    </div>
                </a>
            </li>
            <li>
                <a id="collections-link" style="text-decoration: none; color: inherit;">
                <div class="icon-container" style="background-color: #466a88;">
                    <div class="vertical-rectangles">
                    <!-- Replace icon with rectangles -->
                    <div class="rectangle"></div>
                    <div class="rectangle"></div>
                    <div class="rectangle"></div>
                    </div>
                    <p class="icon-title">Collections</p> <!-- Title to appear on hover -->
                </div>
                </a>
            </li>
            <li><div class="icon-container" style="background-color: #684386;"><div class="horizontal-rectangle"></div><img src="icons/Box.png" alt="Assets" title="Assets"><p class="icon-title">Free</p></div></li>
            <li><div class="icon-container" style="background-color: #59aa60;"><img src="icons/Check.png" alt="Contact" title="Contact"><p class="icon-title">Purchased</p></div></li>
            <li><div class="icon-container" style="background-color: #c95151;"><img src="icons/Heart.png" alt="Settings" title="Settings"><p class="icon-title">Liked</p></div></li>
        </ul>
    </div>

    <header>
        <nav>
            <ul>
                <li class="left">
                    <h3><a href="index.html"><img src="./Icons/DagdaLogoClear.png" alt="Image" style="width: 45px; height: 45px; margin-right: 5px; margin-top: -5px; vertical-align: middle;">Dagda</a></h3>
                </li>
                <!-- Button for toggling the dropdown menu -->
                <li class="menu-toggle" id="menu-toggle"><span>&#9776;</span></li>
                <div class="right-group" id="right-group">
                    <li><a class="Aboutref" href="About.html">About</a></li>
                    <li><a class="Assetsref" href="Assets.html">Assets</a></li>
                    <li><a class="Blogref" href="Blog.html">Blog</a></li>
                    <li><a class="Signinref" href="Signin.html">Sign in</a></li>
                    <li><a class="Subscriberef" href="Subscribe.html">Subscribe</a></li>
                </div>
            </ul>
        </nav>
        <div class="header-bar"></div>
        <script>
            // Function to set the header's background color
            function setBackgroundColor(color) {
                const header = document.querySelector('.header-bar');
                if (header) {  // Check if the header element exists
                    header.style.backgroundColor = color;
                }
            }
        
            // Function to save the current color
            function saveCurrentColor(color) {
                localStorage.setItem('prevColor', color);
            }
        
            document.addEventListener('DOMContentLoaded', function() {
                const prevColor = localStorage.getItem('prevColor');
                const assetColor = '#ffbf00'; // Color when asset containers are loaded
                const collectionColor = '#466a88'; // Color when collection containers are loaded
                const collectionsButton = document.getElementById('collections-link'); // Button for loading collections
        
                // Initialize the header color
                setBackgroundColor(prevColor || assetColor);
        
                // Event listener for loading asset containers
                // Assuming you call a function to load assets after DOM is fully loaded
                loadAssets();  // Placeholder function, you'll need to define or replace it according to your actual functionality
        
                // Event listener for the collections button
                if (collectionsButton) {
                    collectionsButton.addEventListener('click', function() {
                        setBackgroundColor(collectionColor);
                        saveCurrentColor(collectionColor);  // Save the collection color
                    });
                }
        
                // Transition to new color after a short delay if prevColor was set
                if (prevColor) {
                    setTimeout(() => setBackgroundColor(assetColor), 50);
                }
        
                // Save the current color before the page unloads
                window.addEventListener('beforeunload', function() {
                    saveCurrentColor(document.querySelector('.header-bar').style.backgroundColor);
                });
            });
        
            // Function to simulate loading assets
            function loadAssets() {
                // Simulated behavior, replace with actual logic to load assets
                setTimeout(() => {
                    setBackgroundColor('orange');
                    saveCurrentColor('orange');
                }, 100); // Simulate asset load
            }

            

                // Toggle menu visibility on small screens
                const menuToggle = document.getElementById('menu-toggle');
                const rightGroup = document.getElementById('right-group');
    
                rightGroup.style.display = 'none'; // Ensure menu is hidden by default
    
                menuToggle.addEventListener('click', function() {
                    if (rightGroup.style.display === 'none' || rightGroup.style.display === '') {
                        rightGroup.style.display = 'block';
                    } else {
                        rightGroup.style.display = 'none';
                    }
                });            
        </script>
        
            
    </header>

    <!-- Sub-header with 8 dropdowns and labels above -->
    <div id="sub-header" class="sub-header">
        <div class="dropdown-container">
            <label for="Style">Style</label>
            <div class="select-container">
                <select onchange="loopFunction()" id="Style">
                    <option value="Any">Any</option>
                </select>
            </div>
        </div>
        <div class="dropdown-container">
            <label for="Type">Type</label>
            <div class="select-container">
                <select onchange="loopFunction()" id="Type">
                    <option value="Any">Any</option>
                </select>
            </div>
        </div>
        <div class="dropdown-container">
            <label for="Size">Size</label>
            <div class="select-container">
                <select onchange="loopFunction()" id="Size">
                    <option value="Any">Any</option>
                    <option value="Size: < 0.5 M">Size: < 0.5 M</option>
                    <option value="Size: 1 - 2 M">Size: 1 - 2 M</option>
                    <option value="Size: 4 - 8 M">Size: 4 - 8 M</option>
                </select>
            </div>
        </div>
        <div class="dropdown-container">
            <label for="State">State</label>
            <div class="select-container">
                <select onchange="loopFunction()" id="State">
                    <option value="Any">Any</option>
                    <option value="New">New</option>
                    <option value="Old">Old</option>
                    <option value="Damaged">Damaged</option>
                </select>
            </div>
        </div>
        <div class="dropdown-container">
            <label for="Environment">Environment</label>
            <div class="select-container">
                <select onchange="loopFunction()" id="Environment">
                    <option value="Any">Any</option>
                </select>
            </div>
        </div>
        <div class="dropdown-container">
            <label for="Biome">Biome</label>
            <div class="select-container">
                <select onchange="loopFunction()" id="Biome">
                    <option value="Any">Any</option>
                </select>
            </div>
        </div>
        <div class="dropdown-container">
            <label for="Collection">Collection</label>
            <div class="select-container">
                <select onchange="loopFunction()" id="Collection">
                    <option value="Any">Any</option>
                </select>
            </div>
        </div>
        <div class="dropdown-container">
            <label for="Color">Color</label>
            <div class="select-container">
                <select onchange="loopFunction()" id="Color">
                    <option value="Any">Any</option>
                </select>
            </div>
        </div>
    </div>

    <main>
        <div id="Assetsbanner" class="Assetsbanner">
            <p>Assets</p>
        </div>

        <div id="Collectionsbanner" class="Collectionsbanner" style="display: none;">
            <p>Collections</p>
        </div>       
        <div id="content-wrapper"></div>
    </main>
        <div id="sidebar">
        <button onclick="closeSidebar()">Close</button>
    </div>
    <div id="imageContainer"></div>

    <footer>
        <p>&copy; 2024 Simple Website. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const collectionsButton = document.getElementById('collections-link');
            if (collectionsButton) {
                collectionsButton.addEventListener('click', function(event) {
                    event.preventDefault(); // Prevent the link from navigating
                    clearContent('#content-wrapper'); // Clear collections before displaying new ones
                    displayCollections(assetMap); // Assuming assetMap is defined in one of your scripts
                });
            }
            const assetsButton = document.getElementById('assets-link');
            if (assetsButton) {
                assetsButton.addEventListener('click', function(event) {
                    event.preventDefault();
                    clearContent('#content-wrapper');
                    setCollectionAndReloadAssets("Any");
                })
            }
            /////////////////////////////////////////
        
            function displayCollections(assetMap) {
    const contentWrapper = document.querySelector('#content-wrapper'); // Target the content-wrapper element
    if (contentWrapper) {
        const collections = groupAssetsByCollection(assetMap);
        Object.keys(collections).forEach(collectionName => {
            const collectionContainer = document.createElement('div');
            collectionContainer.classList.add('collection-container', 'sliding-in'); // Add animation class
            collectionContainer.id = 'collection-' + collectionName;

            const title = document.createElement('p');
            title.textContent = collectionName;
            collectionContainer.appendChild(title);

            // Add event listener to collection container
            collectionContainer.addEventListener('click', () => {
                clearContent('#imageContainer'); // Clear assets when collection is clicked
                setCollectionAndReloadAssets(collectionName);
            });

            contentWrapper.appendChild(collectionContainer); // Append new content
            clearContent('#imageContainer');
            hideSubHeader()
        });
    } else {
        console.log("Content-wrapper element not found!");
    }
}

        
            function groupAssetsByCollection(assetMap) {
                const collectionGroups = {};
                assetMap.forEach((asset, assetName) => {
                    const collectionName = asset.Collection;
                    if (!collectionGroups[collectionName]) {
                        collectionGroups[collectionName] = [];
                    }
                    collectionGroups[collectionName].push({ asset, assetName });
                });
                return collectionGroups;
            }
        
            function setCollectionAndReloadAssets(collectionName) {
                clearContent('#content-wrapper'); // Clear the collection display
                document.getElementById('Collection').value = collectionName; // Set the dropdown
                loopFunction(); // Reload assets (ensure this function exists and is properly defined)
                showSubHeader()
                loadAssets()
            }
        
            function clearContent(selector, callback) {
                const element = document.querySelector(selector);
                if (element) {
                    element.innerHTML = ''; // Clear the content of the specified element
                    if (callback) {
                        callback(); // Call the callback function if provided
                    }
                } else {
                    console.log(selector + " not found!");
                }
            }





            var collectionClicked = localStorage.getItem('ClickedCollection');
            localStorage.setItem("ClickedCollection", "")
            console.log (collectionClicked)
            console.log (localStorage.getItem('ClickedCollection'))

            if (collectionClicked !== "") {
            console.log("hi")

            const selectElement = document.getElementById('Collection');

                            // Function to check if the option exists and set it
                            const setCollectionOption = () => {
                    const optionExists = Array.from(selectElement.options).some(option => option.value === collectionClicked);

                    if (optionExists) {
                        selectElement.value = collectionClicked;
                        clearContent('#content-wrapper'); // Clear the collection display
                        loopFunction(); // Reload assets (ensure this function exists and is properly defined)
                        loadAssets();
                        return true;
                    }
                    return false;
                };

                // If the option already exists, set it
                if (!setCollectionOption()) {
                    // If the option doesn't exist, use a MutationObserver to wait for it
                    const observer = new MutationObserver((mutationsList, observer) => {
                        if (setCollectionOption()) {
                            observer.disconnect(); // Stop observing once the option is set
                        }
                    });

                    observer.observe(selectElement, { childList: true });
                }
            }
        });




        /**
 * Shows the sub-header by setting its display style to 'block'.
 */
function showSubHeader() {
    const subHeader = document.getElementById('sub-header');
    const collectionsBanner = document.getElementById('Collectionsbanner');
    const assetsBanner = document.getElementById('Assetsbanner');
    if (subHeader) {
        subHeader.style.display = 'flex'; // You can change 'block' to 'flex' or another display type depending on your layout needs
    } else {
        console.log('Sub-header element not found!');
    }

    // Hide the collections banner
    if (collectionsBanner) {
        collectionsBanner.style.display = "none";
    } else {
        console.log('Collections banner element not found!');
    }

    // Show the assets banner
    if (assetsBanner) {
        assetsBanner.style.display = "flex";
    } else {
        console.log('Assets banner element not found!');
    }

}

/**
 * Hides the sub-header by setting its display style to 'none'.
 */
 function hideSubHeader() {
    const subHeader = document.getElementById('sub-header');
    const collectionsBanner = document.getElementById('Collectionsbanner');
    const assetsBanner = document.getElementById('Assetsbanner');

    // Hide the sub-header
    if (subHeader) {
        subHeader.style.display = 'none';
    } else {
        console.log('Sub-header element not found!');
    }

    // Show the collections banner
    if (collectionsBanner) {
        collectionsBanner.style.display = "flex";
    } else {
        console.log('Collections banner element not found!');
    }

    // Hide the assets banner
    if (assetsBanner) {
        assetsBanner.style.display = "none";
    } else {
        console.log('Assets banner element not found!');
    }
}

        </script>
        
</body>
</html>
